#!/usr/bin/env bash

if [ $(uname -s) = "Darwin" ]; then
    alias ls='ls --color=auto'
    alias ll='ls -l'
else
    alias open="xdg-open"
fi

export WD=$(pwd)
export RUSTUP_HOME="$WD/.rustup_home"
export CARGO_HOME="$WD/.cargo_home"

xs=(
    $RUSTUP_HOME
    $CARGO_HOME/bin
    $WD/data/schedules
    $WD/data/events
    $WD/data/shifts
)

for x in "${xs[@]}"; do
    if [ ! -d $x ]; then
        mkdir -p $x
    fi
done

PATH="$PATH:$CARGO_HOME/bin"

if [ ! -f .init ]; then
    rustup install stable
    rustup default stable
    rustup component add rustfmt
    rustup component add clippy
    touch .init
fi

rustup update

rustfmts() {
    for f in $WD/dev/src/*.rs; do
        echo $f
        rustfmt $f
    done
}

clippy() {
    cargo clippy -- -D warnings -W clippy::pedantic
}

export -f rustfmts
export -f clippy
alias rusttest="cargo test -q"
alias sql="rlwrap sqlite3 --column --header"
